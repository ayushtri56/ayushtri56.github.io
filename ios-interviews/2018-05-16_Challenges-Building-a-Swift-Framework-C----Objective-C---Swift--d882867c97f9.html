<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Challenges Building a Swift Framework(C++, Objective C &amp; Swift)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Challenges Building a Swift Framework(C++, Objective C &amp; Swift)</h1>
</header>
<section data-field="subtitle" class="p-summary">
This talk focuses on the challenges of building a Swift framework. I will cover how we overcame these challenges, the experience we got…
</section>
<section data-field="body" class="e-content">
<section name="0375" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5ee6" id="5ee6" class="graf graf--h3 graf--leading graf--title">Challenges Building a Swift Framework(C++, Objective C &amp; Swift)</h3><p name="fa4b" id="fa4b" class="graf graf--p graf-after--h3">This talk focuses on the challenges of building a Swift framework. I will cover how we overcame these challenges, the experience we got from it, and the lessons learned. I hope it will help you understand how to build open source or third party software on mobile, and how you can do it right.</p><p name="f087" id="f087" class="graf graf--p graf-after--p">The main challenge is how to interface C++ with Swift.When we want to build something on top of something else from a library or source file. This was the case for us. You want to use yourself to build a wrapper on top of that.</p><h3 name="343b" id="343b" class="graf graf--h3 graf-after--p">A Viable Way to Distribute a Framework</h3><p name="3635" id="3635" class="graf graf--p graf-after--h3">Our first idea was to have just one big framework which contained another framework. Then, we would hide away the underlying Objective-C part that you don’t want to deal with if you start out building a new Swift app.</p><p name="9f3f" id="9f3f" class="graf graf--p graf-after--p">It turns out there were several difficulties with this approach. For one, you would have to mess around with build settings as a user. Even so, this was historically available for a long time on OSX.However, <strong class="markup--strong markup--p-strong">the App Store doesn’t allow this concept at all</strong>, with code signing, so it wasn’t usable for us because we want to allow our users to build real apps for the App Store.</p><p name="a774" id="a774" class="graf graf--p graf-after--p">Lets talk some thing new, Did you ever heard of modular framework ? or custom module map? if NO then lets deep dive into it for a minute to get basic idea.</p><h3 name="76fc" id="76fc" class="graf graf--h3 graf-after--p">What is a modular framework</h3><p name="0073" id="0073" class="graf graf--p graf-after--h3">A modular framework is a framework that contains a module map. This module map can either be generated from building the framework, or , not so-commonly, specified as a build settings in the framework project.</p><p name="274b" id="274b" class="graf graf--p graf-after--p">In order for Xcode to generate the module map file, a framework has to have an umbrella header with the same name of the framework and to have the <code class="markup--code markup--p-code">Define Module</code> (<code class="markup--code markup--p-code">DEFINES_MODULE</code>) build settings set to yes. When building this framework, Xcode will generate a framework bundle that contains a <code class="markup--code markup--p-code">Modules</code> director.</p><p name="5a35" id="5a35" class="graf graf--p graf-after--p">This <code class="markup--code markup--p-code">Modules</code> directory contains the generated modules map (<code class="markup--code markup--p-code">module.modulemap</code>) with the following content:</p><pre name="3348" id="3348" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">framework <strong class="markup--strong markup--pre-strong">module</strong> <strong class="markup--strong markup--pre-strong">MixModuleFramework</strong> {<br>  umbrella header &quot;</code>MixModuleFramework<code class="markup--code markup--pre-code">.h&quot;</code></pre><pre name="0634" id="0634" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  export *<br>  <strong class="markup--strong markup--pre-strong">module</strong> * { <strong class="markup--strong markup--pre-strong">export</strong> * }<br>}</code></pre><p name="7099" id="7099" class="graf graf--p graf-after--pre">Before deciphering the default module map file, lets roll our sleeves and write our own map file.</p><h3 name="f9fc" id="f9fc" class="graf graf--h3 graf-after--p">Custom module map</h3><p name="bc91" id="bc91" class="graf graf--p graf-after--h3">A framework can specify a custom map file by setting <code class="markup--code markup--p-code">Module Map File</code> (<code class="markup--code markup--p-code">MODULEMAP_FILE</code>) Xcode build setting to the map file path. Lets start by creating the simplest module map possible.</p><pre name="d4f7" id="d4f7" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">framework <strong class="markup--strong markup--pre-strong">module</strong> <strong class="markup--strong markup--pre-strong">MixModuleFramework</strong> {<br>  umbrella header &quot;MixModuleFramework.h&quot;<br>}</code></pre><p name="0c7e" id="0c7e" class="graf graf--p graf-after--pre">In this module map we only specify the umbrella header file. This header is the header that imports all other headers.</p><p name="0c14" id="0c14" class="graf graf--p graf-after--p">For more details on module map, please refer this link <a href="http://clang.llvm.org/docs/Modules.html#module-map-file" data-href="http://clang.llvm.org/docs/Modules.html#module-map-file" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">http://clang.llvm.org/docs/Modules.html#module-map-file</a></p><h3 name="b8d5" id="b8d5" class="graf graf--h3 graf-after--p">Using C++ file in Swift Framework</h3><p name="4b8d" id="4b8d" class="graf graf--p graf-after--h3">Lets start with Objective C wrapper on C++ then include objective C file in Bridging header and try to use in swift file . OOPS Surprise!!</p><p name="1429" id="1429" class="graf graf--p graf-after--p">As convenient as the bridging header is, it has one key limitation — you can’t use it inside a framework project. The alternative is to use a <a href="http://clang.llvm.org/docs/Modules.html" data-href="http://clang.llvm.org/docs/Modules.html" class="markup--anchor markup--p-anchor" title="Clang Module documentation" rel="noopener" target="_blank">module</a>.</p><h3 name="4793" id="4793" class="graf graf--h3 graf-after--p">Let’s create a demo framework for Mix type (C++, ObjC and Swift)</h3><p name="f347" id="f347" class="graf graf--p graf-after--h3">I call this demo framework — MixModuleFramework. Open Xcode , select File -&gt;New-&gt;Project-&gt; Choose Cocoa Touch Framework in framework sections.</p><figure name="a75f" id="a75f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MjYdKc7KbxO1NA3h9vb-sg.png" data-width="734" data-height="529" src="https://cdn-images-1.medium.com/max/800/1*MjYdKc7KbxO1NA3h9vb-sg.png"></figure><p name="8ad6" id="8ad6" class="graf graf--p graf-after--figure">Press next and enter your framework name.</p><figure name="3d6e" id="3d6e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6FILolaRhd2kOGAla8X-IA.png" data-width="733" data-height="527" src="https://cdn-images-1.medium.com/max/800/1*6FILolaRhd2kOGAla8X-IA.png"></figure><p name="2517" id="2517" class="graf graf--p graf-after--figure">Once you are done with creating , empty framework project is ready to build.</p><p name="7fb1" id="7fb1" class="graf graf--p graf-after--p">When you build your framework, Xcode will generate a module map that includes the <strong class="markup--strong markup--p-strong">umbrella header</strong>. Here is the generated module map for a custom framework target which supports modules:</p><pre name="04b5" id="04b5" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">framework module MixModuleFramework {<br>  umbrella header &quot;MixModuleFramework.h&quot;</code></pre><pre name="3077" id="3077" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">  export *<br>  module * { export * }<br>}</code></pre><p name="4b0c" id="4b0c" class="graf graf--p graf-after--pre">Now you can start adding your C++ files, Objective C wrappers and Swift files in it.</p><figure name="3d47" id="3d47" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6pjsXxtCj-aNpnqWf4qWhA.png" data-width="207" data-height="222" src="https://cdn-images-1.medium.com/max/800/1*6pjsXxtCj-aNpnqWf4qWhA.png"></figure><p name="23dc" id="23dc" class="graf graf--p graf-after--figure">Few things to remember before building the framework, This demo framework gives TestCode class a interface to this framework , objective C or Swift based project can directly use it But as we earlier talk about modular framework, This TestCode module need to be modularized , Please make sure you make this file as public.</p><figure name="c6f3" id="c6f3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZZLgw2uGJARj7MnY5Lczvw.png" data-width="973" data-height="27" src="https://cdn-images-1.medium.com/max/800/1*ZZLgw2uGJARj7MnY5Lczvw.png"><figcaption class="imageCaption">Error for non modular header</figcaption></figure><figure name="2f31" id="2f31" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*fQL__3Le610NE6FtSp6Nvw.png" data-width="1001" data-height="541" src="https://cdn-images-1.medium.com/max/800/1*fQL__3Le610NE6FtSp6Nvw.png"><figcaption class="imageCaption">Solution to resolve above error</figcaption></figure><p name="aa09" id="aa09" class="graf graf--p graf-after--figure">As i have written some private API which need not to be exposed, Please make sure you have created modular map file like below.</p><figure name="8775" id="8775" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*elTYfzvl6W3CgDjVDaEaNg.png" data-width="796" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*elTYfzvl6W3CgDjVDaEaNg.png"></figure><p name="d366" id="d366" class="graf graf--p graf-after--figure">Please make sure that you have added import search path also in your project to avoid build error.</p><figure name="62df" id="62df" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*M1TOVKhAxbhVR2WLeWGAYA.png" data-width="836" data-height="444" src="https://cdn-images-1.medium.com/max/800/1*M1TOVKhAxbhVR2WLeWGAYA.png"></figure><p name="2784" id="2784" class="graf graf--p graf-after--figure">Once you are done with all the setting and importing your files into your framework project.</p><p name="7217" id="7217" class="graf graf--p graf-after--p">Its time to build the framework project and test it.</p><p name="06df" id="06df" class="graf graf--p graf-after--p">You can find the source code for this article <a href="https://github.com/charlieInDen/MixModuleFramework" data-href="https://github.com/charlieInDen/MixModuleFramework" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/charlieInDen/MixModuleFramework</a></p><p name="0231" id="0231" class="graf graf--p graf-after--p">For making your custom framework — Universal framework, Please read this article — <a href="https://medium.com/@nishantsamsung09/writing-custom-universal-framework-in-xcode-9-and-ios-11-7a63a2ce024a" data-href="https://medium.com/@nishantsamsung09/writing-custom-universal-framework-in-xcode-9-and-ios-11-7a63a2ce024a" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">https://medium.com/@nishantsamsung09/writing-custom-universal-framework-in-xcode-9-and-ios-11-7a63a2ce024a</a></p><p name="2379" id="2379" class="graf graf--p graf-after--p">Hope this article is useful for people looking to create custom <strong class="markup--strong markup--p-strong">swift based </strong>framework, Please ❤️ to recommend this post to others 😊. Let me know your feedback. :)</p><p name="a847" id="a847" class="graf graf--p graf-after--p">References:</p><ol class="postList"><li name="aba7" id="aba7" class="graf graf--li graf-after--p graf--trailing">http://nsomar.com/modular-framework-creating-and-using-them/</li></ol></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@nishantnitb" class="p-author h-card">Nishant Sharma</a> on <a href="https://medium.com/p/d882867c97f9"><time class="dt-published" datetime="2018-05-16T08:35:41.186Z">May 16, 2018</time></a>.</p><p><a href="https://medium.com/@nishantnitb/challenges-building-a-swift-framework-d882867c97f9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on February 11, 2021.</p></footer></article></body></html>